<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Challenge DevOps Team" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>4 Container Image Builder - Challenge DevOps</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "4 Container Image Builder";
        var mkdocs_page_input_path = "golang/projects/4-Container-Image-Builder.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../index.html" class="icon icon-home"> Challenge DevOps
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../index.html">About Us</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Code Rendering Types</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../rendering/concept.html">Concept</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rendering/CSR.html">CSR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rendering/SSR.html">SSR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rendering/SSG.html">SSG</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rendering/ISR.html">ISR</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Networking</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/networking-overview.html">Networking overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/important-commands.html">Important commands</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/traceroute.html">Traceroute</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/netstat.html">Netstat</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/nslookup-dig.html">Nslookup dig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/ssh.html">Ssh</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/telnet.html">Telnet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/nmap.html">Nmap</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/learning/curl-wget.html">Curl wget</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">projects</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../networking/projects/1-Setting-Up-a-Secure-VPN.html">1 Setting Up a Secure VPN</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Proxies</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../proxies/learning/overview.html">Overview</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">projects</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../proxies/projects/1-Reverse-Proxy-Server-Nginx.html">1 Reverse Proxy Server Nginx</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Ansible</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/learning/1-overview.html">1 overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/learning/2-basic.html">2 basic</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/learning/3-ansible-features.html">3 ansible features</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">projects</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/projects/1-Web-Server-nginx.html">1 Web Server nginx</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/projects/2-Managing-System-Packages.html">2 Managing System Packages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/projects/3-Configuring-a-Firewall.html">3 Configuring a Firewall</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/projects/4-Web-App-Using-Docker.html">4 Web App Using Docker</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ansible/projects/5-run-nginx-container.html">5 run nginx container</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Golang</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../learning/important-packages.html">Important packages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/func-breakdown.html">Func breakdown</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/pointers-dereferencing.html">Pointers dereferencing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/methods.html">Methods</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/struct.html">Struct</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/interface.html">Interface</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/interface-ex-2.html">Interface ex 2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/file-operations.html">File operations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/complex-struct.html">Complex struct</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/database-struct.html">Database struct</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/db-connection.html">Db connection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/db-crud.html">Db crud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/json.html">Json</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/yaml.html">Yaml</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/os-package.html">Os package</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/os-exec.html">Os exec</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/path-filepath.html">Path filepath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/encoding-json.html">Encoding json</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/net-http.html">Net http</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/strconv.html">Strconv</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/context.html">Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../learning/strings.html">Strings</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">projects</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="1-Simple-CLI-Tool.html">1 Simple CLI Tool</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="2-Web-Server-with-Basic-API.html">2 Web Server with Basic API</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="4-Container-Image-Builder.html">4 Container Image Builder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="7-color-print-message.html">7 color print message</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="8-Currency-Conversion-API.html">8 Currency Conversion API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="9.Todo-List-API.html">9.Todo List API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="10-Recipe-API.html">10 Recipe API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="11-contact-list-csv.html">11 contact list csv</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="12-mongodb-manual.html">12 mongodb manual</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="13-mongoDB-API.html">13 mongoDB API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="14-midleware-okta.html">14 midleware okta</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Bash-Scripting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/learning/special-variable.html">Special variable</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/learning/conditional-expression.html">Conditional expression</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/learning/jq.html">Jq</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/learning/yq.html">Yq</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">projects</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/projects/1-File-Organizer.html">1 File Organizer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/projects/2-System-Monitor.html">2 System Monitor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/projects/3-Backup-Script.html">3 Backup Script</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/projects/4-Web-Log-Analyzer.html">4 Web Log Analyzer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/projects/5-Task-Scheduler.html">5 Task Scheduler</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../bash/projects/6-color-print-message.html">6 color print message</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Challenge DevOps</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Golang</li>
          <li class="breadcrumb-item">projects</li>
      <li class="breadcrumb-item active">4 Container Image Builder</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><strong>4. Container Image Builder:</strong></p>
<ul>
<li><strong>Project:</strong> Build a tool that creates Docker images for your application. This tool can:<ul>
<li>Take a directory containing your application code and dependencies as input.</li>
<li>Create a Dockerfile based on a base image.</li>
<li>Build a container image and push it to a registry.</li>
</ul>
</li>
<li><strong>Learning:</strong>  You'll learn about Docker and containerization, working with Dockerfiles, and automating container image creation.</li>
</ul>
<p>Certainly! Let's build a tool in Go that creates Docker images for your application. Here's an example implementation:</p>
<pre class="codehilite"><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;io/ioutil&quot;
    &quot;log&quot;
    &quot;os&quot;
    &quot;os/exec&quot;
    &quot;path/filepath&quot;
)

func main() {
    // Check if the required arguments are provided
    if len(os.Args) &lt; 4 {
        fmt.Println(&quot;Usage: go run main.go &lt;app-directory&gt; &lt;base-image&gt; &lt;image-name&gt;&quot;)
        os.Exit(1)
    }

    // Get the command-line arguments
    appDir := os.Args[1]
    baseImage := os.Args[2]
    imageName := os.Args[3]

    // Create a temporary directory for the Dockerfile
    tempDir, err := ioutil.TempDir(&quot;&quot;, &quot;docker-build&quot;)
    if err != nil {
        log.Fatal(err)
    }
    defer os.RemoveAll(tempDir)

    // Create the Dockerfile content
    dockerfile := fmt.Sprintf(`
FROM %s
WORKDIR /app
COPY . .
RUN go build -o main .
CMD [&quot;./main&quot;]
`, baseImage)

    // Write the Dockerfile to the temporary directory
    dockerfilePath := filepath.Join(tempDir, &quot;Dockerfile&quot;)
    err = ioutil.WriteFile(dockerfilePath, []byte(dockerfile), 0644)
    if err != nil {
        log.Fatal(err)
    }

    // Copy the application code and dependencies to the temporary directory
    err = copyDirectory(appDir, tempDir)
    if err != nil {
        log.Fatal(err)
    }

    // Build the Docker image
    buildCmd := exec.Command(&quot;docker&quot;, &quot;build&quot;, &quot;-t&quot;, imageName, tempDir)
    buildCmd.Stdout = os.Stdout
    buildCmd.Stderr = os.Stderr
    err = buildCmd.Run()
    if err != nil {
        log.Fatal(err)
    }

    fmt.Printf(&quot;Docker image '%s' built successfully.\n&quot;, imageName)

    // Push the Docker image to a registry (optional)
    pushCmd := exec.Command(&quot;docker&quot;, &quot;push&quot;, imageName)
    pushCmd.Stdout = os.Stdout
    pushCmd.Stderr = os.Stderr
    err = pushCmd.Run()
    if err != nil {
        log.Fatal(err)
    }

    fmt.Printf(&quot;Docker image '%s' pushed to the registry.\n&quot;, imageName)
}

func copyDirectory(src, dst string) error {
    // Get the list of files and directories in the source directory
    entries, err := ioutil.ReadDir(src)
    if err != nil {
        return err
    }

    // Create the destination directory if it doesn't exist
    err = os.MkdirAll(dst, 0755)
    if err != nil {
        return err
    }

    // Copy each file and directory recursively
    for _, entry := range entries {
        srcPath := filepath.Join(src, entry.Name())
        dstPath := filepath.Join(dst, entry.Name())

        if entry.IsDir() {
            err = copyDirectory(srcPath, dstPath)
            if err != nil {
                return err
            }
        } else {
            err = copyFile(srcPath, dstPath)
            if err != nil {
                return err
            }
        }
    }

    return nil
}

func copyFile(src, dst string) error {
    // Read the source file
    data, err := ioutil.ReadFile(src)
    if err != nil {
        return err
    }

    // Write the data to the destination file
    err = ioutil.WriteFile(dst, data, 0644)
    if err != nil {
        return err
    }

    return nil
}
</code></pre>

<p>To use this tool:</p>
<ol>
<li>
<p>Save the code in a file named <code>main.go</code>.</p>
</li>
<li>
<p>Open a terminal and navigate to the directory containing <code>main.go</code>.</p>
</li>
<li>
<p>Run the following command:</p>
</li>
</ol>
<p><code>go run main.go &lt;app-directory&gt; &lt;base-image&gt; &lt;image-name&gt;</code></p>
<p>Replace <code>&lt;app-directory&gt;</code> with the path to the directory containing your application code and dependencies, <code>&lt;base-image&gt;</code> with the desired base image (e.g., <code>golang:latest</code>), and <code>&lt;image-name&gt;</code> with the desired name for your Docker image (e.g., <code>myapp:v1</code>).</p>
<p>Here's how the tool works:</p>
<ol>
<li>
<p>It checks if the required command-line arguments are provided. If not, it displays the usage instructions and exits.</p>
</li>
<li>
<p>It creates a temporary directory to store the generated Dockerfile and the copied application code.</p>
</li>
<li>
<p>It generates the Dockerfile content based on the provided base image. The Dockerfile sets the working directory to <code>/app</code>, copies the application code and dependencies, builds the Go application, and sets the default command to run the built executable.</p>
</li>
<li>
<p>It writes the generated Dockerfile to the temporary directory.</p>
</li>
<li>
<p>It copies the application code and dependencies from the specified <code>&lt;app-directory&gt;</code> to the temporary directory using the <code>copyDirectory</code> function.</p>
</li>
<li>
<p>It executes the <code>docker build</code> command to build the Docker image using the generated Dockerfile and the copied application code. The image is tagged with the provided <code>&lt;image-name&gt;</code>.</p>
</li>
<li>
<p>If the build is successful, it displays a success message.</p>
</li>
<li>
<p>Optionally, it executes the <code>docker push</code> command to push the built Docker image to a registry. Make sure you are logged in to the registry before running the tool.</p>
</li>
<li>
<p>If the push is successful, it displays a success message.</p>
</li>
</ol>
<p>The <code>copyDirectory</code> function recursively copies all files and directories from the source directory to the destination directory. It uses the <code>copyFile</code> function to copy individual files.</p>
<p>Note: Make sure you have Docker installed and running on your machine before running this tool.</p>
<p>This tool provides a basic framework for creating Docker images for your Go application. You can extend and customize it based on your specific requirements, such as adding more configuration options, handling different base images, or integrating with CI/CD pipelines.</p>
<p>Remember to handle errors appropriately and provide meaningful error messages to the user.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="2-Web-Server-with-Basic-API.html" class="btn btn-neutral float-left" title="2 Web Server with Basic API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="7-color-print-message.html" class="btn btn-neutral float-right" title="7 color print message">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Challenge DevOps Team</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="2-Web-Server-with-Basic-API.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="7-color-print-message.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
